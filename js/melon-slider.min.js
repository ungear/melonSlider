+function(){"use strict";function t(t,e,i,n){var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width",t),s.setAttribute("height",e);var r=document.createElementNS("http://www.w3.org/2000/svg","defs");s.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),a=n?i+"-"+p+"-left-chunk":i+"-"+p+"-right-chunk";o.setAttribute("id",a),r.appendChild(o);var h=document.createElementNS("http://www.w3.org/2000/svg","path");o.appendChild(h);var u=document.createElementNS("http://www.w3.org/2000/svg","image");u.setAttribute("x",0),u.setAttribute("y",0),u.setAttribute("width",t),u.setAttribute("height",e),s.appendChild(u),this.svg=s,this.clipPathId=a,this.path=h,this.image=u,this.visualImageWidth=0,this.isLeft=n,this.width=t,this.height=e}function e(t,e){var i=document.createElement("div");i.style.top=0,i.style.left=0,i.style.position="absolute",i.style.width=this.baseWidth,i.style.height=this.baseHeight,this.el=i}function i(t){this.setOptions(t);var e=this.checkOptions();this.isCorrect=!e,this.isCorrect&&(this.initialize(),this.currentImageIndex=0,this.calculateChunks(),this.setHandlers())}function n(t){return t.naturalWidth>0}function s(t,e){return Math.floor(Math.random()*(e-t))+t}function r(){return Math.random()>.5}function o(t){console.log("melonSlider error : "+t)}function a(t){var e=new i(t);return e.isCorrect?{element:e.parts.sliderContainer,startAutoSlide:e.startAutoSlide.bind(e),stopAutoSlide:e.stopAutoSlide.bind(e),showNextImage:e.showNextImage.bind(e),showPreviousImage:e.showPreviousImage.bind(e)}:null}var h={requestAnimationFrame:"requestAnimationFrame",cssTransition:"cssTransition"},u={brokenLine:"brokenLine",curves:"curves",userCut:"userCut"},l={containerId:"",previousButtonId:"",nextButtonId:"",speed:1e3,cutMode:u.brokenLine,segmentsNumber:4,minSegmentWidth:50,maxSegmentWidth:100,autoSlide:!1,autoSlideDelay:1e3,userCut:"",animationType:h.requestAnimationFrame,cssAnimationTimingFunction:"linear"},p="melon-slider";t.prototype.setImage=function(t){this.image.setAttributeNS("http://www.w3.org/1999/xlink","href",t)},t.prototype.cropByPath=function(t){var e=this.isLeft?"M0,0 "+t+" L0,"+this.height+" L0,0 Z":"M"+this.width+",0 "+t+" L"+this.width+","+this.height+" L"+this.width+",0 Z";this.path.setAttribute("d",e);var i="url(#"+this.clipPathId+")";this.image.setAttribute("clip-path",i)},t.prototype.clear=function(){this.path.removeAttribute("d"),this.image.removeAttribute("clip-path"),this.image.removeAttributeNS("http://www.w3.org/1999/xlink","href")},e.prototype.clearTransitionStyles=function(){this.el.style["transition-property"]="",this.el.style["transition-duration"]="",this.el.style["transition-timing-function"]="",this.el.style["transition-timing-delay"]=""},e.prototype.prepareTransitionStylesToAnimation=function(t){this.el.style["transition-property"]="left",this.el.style["transition-duration"]=t.animationTime+"s",this.el.style["transition-timing-function"]=t.timingFunction||"linear",this.el.style["transition-timing-delay"]="0s"},i.prototype.setOptions=function(t){this.options={};for(var e in l)this.options[e]=e in t?t[e]:l[e]},i.prototype.checkOptions=function(){var t=0;return this.options.containerId||(o("couldn't find container"),t++),this.options.segmentsNumber<1&&(o("wrong segmentsNumber"),t++),t},i.prototype.initialize=function(){var i={};i.sliderContainer=document.getElementById(this.options.containerId),this.images=[];for(var s=i.sliderContainer.getElementsByTagName("img"),r=0;r<s.length;r++){var o=s[r];n(o)?(this.images.push(o),this.images.length>1&&(o.style.display="none")):(i.sliderContainer.removeChild(o),r--)}this.baseWidth=i.sliderContainer.offsetWidth,this.baseHeight=i.sliderContainer.offsetHeight,i.leftChunkContainer=new e(this.baseWidth,this.baseHeight),i.sliderContainer.appendChild(i.leftChunkContainer.el),i.leftChunk=new t(this.baseWidth,this.baseHeight,this.options.containerId,!0),i.leftChunkContainer.el.appendChild(i.leftChunk.svg),i.rightChunkContainer=new e(this.baseWidth,this.baseHeight),i.sliderContainer.appendChild(i.rightChunkContainer.el),i.rightChunk=new t(this.baseWidth,this.baseHeight,this.options.containerId),i.rightChunkContainer.el.appendChild(i.rightChunk.svg),i.previousButton=document.getElementById(this.options.previousButtonId),i.nextButton=document.getElementById(this.options.nextButtonId),this.parts=i},i.prototype.calculateChunks=function(){this.chunksCalculationInProgress=!0,this.parts.leftChunk.setImage(this.images[this.currentImageIndex].src),this.parts.rightChunk.setImage(this.images[this.currentImageIndex].src);var t;switch(this.options.cutMode){case u.brokenLine:t=this.generateBrokenLineCut();break;case u.curves:t=this.generateBezierCurveCut();break;case u.userCut:t=this.options.userCut}this.parts.leftChunk.cropByPath(t.path),this.parts.rightChunk.cropByPath(t.path),this.parts.leftChunk.visualImageWidth=t.maxX,this.parts.rightChunk.visualImageWidth=this.baseWidth-t.minX,this.parts.leftChunkContainer.el.style.left=0,this.parts.rightChunkContainer.el.style.left=0,this.chunksCalculationInProgress=!1,this.onReadyForNewAnimation()},i.prototype.generateBrokenLineCut=function(){var t="",e=[],i=[],n=this.baseWidth,o=0,a=parseInt(this.baseWidth/2);i.push(0);for(var h=this.baseHeight/this.options.segmentsNumber,u=.5*h,l=1;l<this.options.segmentsNumber;l++){var p=l*h-u,m=l*h+u,d=s(p,m);i.push(d)}i.push(this.baseHeight);for(var c=r(),g=0;g<i.length;g++){var C=c?a-this.options.maxSegmentWidth:a+this.options.minSegmentWidth,f=c?a-this.options.minSegmentWidth:a+this.options.maxSegmentWidth,y=s(C,f);e.push(y),c=!c,y>o&&(o=y),n>y&&(n=y)}t+="L";for(var v=0;v<i.length;v++)t+=e[v]+","+i[v]+" ";return{path:t,maxX:o,minX:n}},i.prototype.generateBezierCurveCut=function(){function t(t){var e=s(d,c);return t+e}function e(t,e){var i=n(),r=s(t+(e-t)/2,e);return{x:i,y:r}}function i(t){var e=n(),i=s(0,t/2),r=n(),o=s(t/2,t);return[{x:e,y:i},{x:r,y:o}]}function n(){return p?s(o-h,o-a):s(o+a,o+h)}var o=parseInt(this.baseWidth/2),a=this.options.minSegmentWidth,h=this.options.maxSegmentWidth,u=o-h,l=o+h,p=r(),m=this.baseHeight/this.options.segmentsNumber,d=m/2,c=1.5*m,g="",C=[];C.push(0);for(var f=1;f<this.options.segmentsNumber;f++){var y=t(C[f-1]);C.push(y)}C.push(this.baseHeight);for(var v=0;v<this.options.segmentsNumber;v++){if(0==v){var I=i(C[1]);g="L"+o+","+C[0]+" C"+I[0].x+","+I[0].y+" "+I[1].x+","+I[1].y+" "+o+","+C[1]}else{var w=e(C[v],C[v+1]);g+=" S"+w.x+","+w.y+" "+o+","+C[v+1]}p=!p}return{path:g,maxX:l,minX:u}},i.prototype.setHandlers=function(){this.parts.nextButton&&this.parts.nextButton.addEventListener("click",this.showNextImage.bind(this)),this.parts.previousButton&&this.parts.previousButton.addEventListener("click",this.showPreviousImage.bind(this))},i.prototype.showNextImage=function(){this.options.autoSlide=!1,this.animationInProcess||this.chunksCalculationInProgress||this.changeSlide(!0)},i.prototype.showPreviousImage=function(){this.options.autoSlide=!1,this.animationInProcess||this.chunksCalculationInProgress||this.changeSlide(!1)},i.prototype.changeSlide=function(t){this.animationInProcess=!0,t?this.increaseCurrentImageIndex():this.decreaseCurrentImageIndex();for(var e=0;e<this.images.length;e++){var i=this.images[e];i.style.display=e==this.currentImageIndex?"block":"none"}switch(this.options.animationType){case h.requestAnimationFrame:this.startFrameAnimation();break;case h.cssTransition:this.startCssAnimation()}},i.prototype.startFrameAnimation=function(){function t(e){var a=parseInt(n.parts.leftChunkContainer.el.style.left),u=parseInt(n.parts.rightChunkContainer.el.style.left),l=s>-a,p=r>u;if(l||p){h(t);var m=i?e-i:0;i=e;var d=m/1e3,c=parseInt(d*o);n.parts.leftChunkContainer.el.style.left=a-c+"px",n.parts.rightChunkContainer.el.style.left=u+c+"px"}else n.afterEndAnimation()}function e(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-a)),n=window.setTimeout(function(){t(e+i)},i);return a=e+i,n}var i,n=this,s=this.parts.leftChunk.visualImageWidth,r=this.parts.rightChunk.visualImageWidth,o=this.options.speed,a=0,h="function"==typeof window.requestAnimationFrame?window.requestAnimationFrame:e;h(t)},i.prototype.startCssAnimation=function(){var t=this.parts.leftChunk.visualImageWidth,e=this.parts.rightChunk.visualImageWidth,i=Math.max(t,e),n=i/this.options.speed,s=this,r={animationTime:n,timingFunction:this.options.cssAnimationTimingFunction};this.parts.leftChunkContainer.prepareTransitionStylesToAnimation(r),this.parts.rightChunkContainer.prepareTransitionStylesToAnimation(r),this.parts.leftChunkContainer.el.style.left=-t,this.parts.rightChunkContainer.el.style.left=e,setTimeout(function(){s.parts.leftChunkContainer.clearTransitionStyles(),s.parts.rightChunkContainer.clearTransitionStyles(),s.afterEndAnimation()},1e3*n)},i.prototype.onReadyForNewAnimation=function(){var t=this;this.options.autoSlide&&setTimeout(function(){t.options.autoSlide&&t.changeSlide(!0)},this.options.autoSlideDelay)},i.prototype.afterEndAnimation=function(){this.animationInProcess=!1,this.parts.leftChunk.clear(),this.parts.rightChunk.clear(),this.calculateChunks()},i.prototype.increaseCurrentImageIndex=function(){this.currentImageIndex++,this.currentImageIndex===this.images.length&&(this.currentImageIndex=0)},i.prototype.decreaseCurrentImageIndex=function(){this.currentImageIndex--,this.currentImageIndex<0&&(this.currentImageIndex=this.images.length-1)},i.prototype.startAutoSlide=function(){this.options.autoSlide||(this.options.autoSlide=!0,this.animationInProcess||this.chunksCalculationInProgress||this.changeSlide(!0))},i.prototype.stopAutoSlide=function(){this.options.autoSlide=!1},window.MelonSlider=a}();